<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>RSali - تسجيل مطعم</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fafafa;
      padding: 20px;
      direction: rtl;
    }
    .box {
      width: 350px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px #0002;
    }
    input {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      width: 100%;
      padding: 10px;
      background: #ff7b00;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 17px;
      cursor: pointer;
    }
    .msg {
      margin-top: 10px;
      font-size: 15px;
      color: #444;
    }
  </style>
</head>
<body>

<div class="box">
  <h2 style="text-align:center;">تسجيل مطعم</h2>

  <input id="email" placeholder="البريد الإلكتروني">
  <input id="password" type="password" placeholder="كلمة السر">

  <input id="restaurant_name" placeholder="اسم المطعم">
  <input id="restaurant_image" placeholder="رابط صورة المطعم">
  <input id="whatsapp" placeholder="رقم الواتساب (مثال +2136...)">

  <button id="registerBtn">تسجيل</button>

  <div class="msg" id="msg"></div>
</div>

<!-- مكتبة Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const supabase = supabase.createClient(
    "https://vhvmwshgzxunosucwrnz.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZodm13c2hnenh1bm9zdWN3cm56Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMTg2OTIsImV4cCI6MjA3ODc5NDY5Mn0.ow3rgxsKBPY5Av-FX_z5URPO6gtdmnLyb7ZIR4IbFTU"
  );

  const btn = document.getElementById("registerBtn");
  const msg = document.getElementById("msg");

  btn.addEventListener("click", async () => {
    msg.innerText = "جاري التسجيل...";

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const restaurant_name = document.getElementById("restaurant_name").value.trim();
    const restaurant_image = document.getElementById("restaurant_image").value.trim();
    const whatsapp = document.getElementById("whatsapp").value.trim();

    if (!email || !password || !restaurant_name || !whatsapp) {
      msg.innerText = "يرجى ملء الخانات المطلوبة.";
      return;
    }

    // 1) إنشاء مستخدم (صاحب مطعم)
    const { data: user, error: userErr } = await supabase
      .from("users")
      .insert({ email, password })
      .select()
      .single();

    if (userErr) {
      msg.innerText = "خطأ: " + userErr.message;
      return;
    }

    // 2) إنشاء سجل المطعم
    await supabase.from("restaurants").insert({
      id: user.id,
      restaurant_name,
      restaurant_image,
      whatsapp
    });

    msg.innerText = "تم التسجيل بنجاح ✔️";
  });
</script>

</body>
</html>
